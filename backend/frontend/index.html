<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ASM BILLING SYSTEM - Admin Login</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>

<body class="bg-slate-50 flex items-center justify-center min-h-screen">

    <div class="bg-white p-8 rounded-xl shadow-lg w-full max-w-md border border-slate-200">
        
        <!-- Header -->
        <div class="text-center mb-8">
            <div class="bg-indigo-600 w-12 h-12 rounded-lg flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-microchip text-white text-xl"></i>
            </div>
            <h1 class="text-2xl font-bold text-slate-800">ASM BILLING SYSTEM</h1>
            <p class="text-slate-500 text-sm">Admin Portal Login</p>
        </div>

        <!-- Login Form -->
        <form id="loginForm" class="space-y-6">

            <!-- Email -->
            <div>
                <label class="block text-sm font-medium text-slate-700 mb-1">Email Address</label>
                <div class="relative">
                    <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-slate-400">
                        <i class="fas fa-envelope"></i>
                    </span>
                    <input
                        type="email"
                        id="email"
                        required
                        class="block w-full pl-10 pr-3 py-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                        placeholder="admin@email.com"
                    >
                </div>
            </div>

            <!-- Password -->
            <div>
                <label class="block text-sm font-medium text-slate-700 mb-1">Password</label>
                <div class="relative">
                    <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-slate-400">
                        <i class="fas fa-lock"></i>
                    </span>
                    <input
                        type="password"
                        id="password"
                        required
                        class="block w-full pl-10 pr-3 py-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                        placeholder="••••••••"
                    >
                </div>
            </div>

            <!-- Button -->
            <button
                type="submit"
                class="w-full py-2 px-4 rounded-md text-white bg-indigo-600 hover:bg-indigo-700 font-semibold transition"
            >
                Sign In
            </button>
        </form>

        <!-- Message -->
        <div id="message" class="mt-4 text-center text-sm hidden"></div>

        <div class="mt-6 text-center text-xs text-gray-400">
            <p>Don't have an account? Ask system administrator.</p>
        </div>
    </div>

    <!-- Script -->
    <script>
    const loginForm = document.getElementById("loginForm");
    const messageDiv = document.getElementById("message");

    loginForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        messageDiv.classList.add("hidden");

        const email = document.getElementById("email").value.trim();
        const password = document.getElementById("password").value.trim();

        try {
            const response = await fetch("https://asm-billing-system.onrender.com/auth/login", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ email, password })
            });

            const result = await response.json();

            if (!response.ok) {
                throw new Error(
                    result.detail?.error_description ||
                    result.detail?.message ||
                    result.detail ||
                    "Invalid credentials"
                );
            }

            if (result.session?.access_token) {
                localStorage.setItem("adminToken", result.session.access_token);
            }

            messageDiv.textContent = "Login successful! Redirecting...";
            messageDiv.className =
                "mt-4 text-center text-sm text-green-600 font-medium";
            messageDiv.classList.remove("hidden");

            setTimeout(() => {
                window.location.href = "/dashboard";
            }, 1000);

        } catch (err) {
            console.error("LOGIN ERROR:", err);
            messageDiv.textContent = err.message;
            messageDiv.className =
                "mt-4 text-center text-sm text-red-600 font-medium";
            messageDiv.classList.remove("hidden");
        }
    });
    </script>


</body>
</html>
